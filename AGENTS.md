# Genesis Developer Guide & Agent Instructions

This document provides a comprehensive guide for both human developers and AI agents working on the Genesis codebase. Follow these instructions to ensure consistency, stability, and efficiency.

**Repository:** [https://github.com/GeorgePearse/Genesis](https://github.com/GeorgePearse/Genesis)

## 1. Quick Start & Common Workflows

### Environment Setup
- **Install (Dev Mode):**
  ```bash
  uv venv --python 3.12
  source .venv/bin/activate
  uv pip install -e ".[dev]"
  ```
- **Reinstall/Update Dependencies:**
  ```bash
  uv pip install -e .
  ```

### Running Experiments
- **Run Default Example:**
  ```bash
  genesis_launch variant=circle_packing_example
  ```
- **Run with Specific Configs:**
  ```bash
  genesis_launch task=circle_packing cluster=local evolution=small_budget
  ```
- **Debug Mode (Verbose):**
  ```bash
  genesis_launch variant=circle_packing_example verbose=true
  ```

### WebUI Development
- **Start WebUI Server:**
  ```bash
  genesis_visualize --port 8888 --open
  ```
- **Frontend Development (Hot Reload):**
  ```bash
  cd genesis/webui/frontend
  npm install
  npm run dev
  ```

### Testing & Quality Assurance
- **Run All Tests:**
  ```bash
  pytest
  ```
- **Run Specific Test File:**
  ```bash
  pytest tests/test_core_runner.py
  ```
- **Linting & Formatting:**
  ```bash
  black genesis tests
  isort genesis tests
  flake8 genesis tests
  ```

---

## 2. Project Structure

Understanding the layout is crucial for navigation.

| Directory | Purpose |
|-----------|---------|
| **`genesis/`** | **Core Source Code**. All Python logic lives here. |
| `genesis/core/` | Main evolution loop (`runner.py`), LLM interaction (`llm.py`), and evaluation logic. |
| `genesis/launch/` | Job scheduling backends (`local.py`, `slurm.py`, `e2b.py`). |
| `genesis/database/` | SQLite/Pickle storage for results and archives. |
| `genesis/webui/` | Backend API for the visualization dashboard. |
| **`configs/`** | **Hydra Configuration**. YAML files for experiments. |
| `configs/task/` | Task definitions (what to solve). |
| `configs/evolution/` | Evolution parameters (generations, population size). |
| `configs/cluster/` | Execution environment settings (Local, Slurm, E2B). |
| **`examples/`** | **Task Implementations**. Start here to add new problems. |
| **`tests/`** | **Unit & Integration Tests**. Mirrors `genesis/` structure. |
| **`docs/`** | **Documentation**. Markdown files for MkDocs. |
| **`genesis/webui/frontend/`** | **React Frontend**. Modern UI code (Vite + React + Tailwind + Shadcn). |

---

## 3. Development Guidelines

### Coding Standards
- **Python Version**: 3.12+
- **Type Hints**: Mandatory for all new functions and classes.
- **Docstrings**: Required for public APIs. Explain *why*, not just *what*.
- **Imports**: Use absolute imports (e.g., `from genesis.core import ...`) instead of relative imports.
- **Logging**: Use `structlog` (if available) or standard `logging`. Do not use `print()` for production logs.

### Adding a New Task
1.  **Create Directory**: `examples/my_task/`
2.  **Initial Solution**: Create `initial.py` with `EVOLVE-BLOCK` markers.
3.  **Evaluator**: Create `evaluate.py` using `genesis.core.run_genesis_eval`.
4.  **Config**: Create `configs/task/my_task.yaml` pointing to your files.
5.  **Verify**: Run `genesis_launch task=my_task ...` to test.

### Adding a New UI Feature
1.  **Backend**: Add endpoints in `genesis/webui/mcp_server.py` or `visualization.py`.
2.  **Frontend Component**: Create new component in `genesis/webui/frontend/src/components/`.
3.  **Routing**: Update `genesis/webui/frontend/src/components/CommandMenu.tsx` to include the new view.
4.  **State**: Update `GenesisContext.tsx` if global state is needed.

---

## 4. Git & Contribution Workflow

- **Branch Naming**: `v2-feature-name` or `v2-fix-bug-name`.
- **Commit Messages**: Semantic commits (`feat:`, `fix:`, `docs:`, `chore:`).
- **Merging Upstream**:
    - Genesis is a fork of `SakanaAI/ShinkaEvolve`.
    - Be careful with the `shinka` -> `genesis` package rename when merging.
    - Always commit local changes before pulling upstream.

---

## 5. Troubleshooting & FAQ

**Q: `genesis` module not found?**
A: Run `uv pip install -e .` to reinstall the package in editable mode.

**Q: WebUI shows no data?**
A: Ensure you have run an experiment first. The WebUI reads from the database file generated by `genesis_launch`. Use Cmd+K -> "Load Database" to select the correct run.

**Q: E2B sandbox fails to start?**
A: Check your `E2B_API_KEY` in `.env`. Ensure you have sufficient credits/quota.

**Q: "ImportError: cannot import name..." after upstream merge?**
A: Check for `from shinka...` imports that slipped in. Replace with `from genesis...`.

---

## 6. Agent-Specific Instructions ðŸ¤–

**For AI Agents working on this repo:**

1.  **Search First**: Before modifying code, search for existing patterns.
    - Grep for `EVOLVE-BLOCK` to understand how code modification works.
    - Grep for `run_genesis_eval` to see how metrics are reported.
2.  **Respect Configs**: Do not hardcode parameters. Use Hydra configs (`configs/`) for tunable values.
3.  **UI is Separate**: The frontend is a standalone React app in `genesis/webui/frontend`. Do not try to modify it via Python files unless editing the API.
4.  **Safety**: Never commit `.env` files or API keys.
5.  **Context**: When analyzing a bug, look at `genesis/core/runner.py` (the heart of the loop) and `genesis/core/llm.py` (the brain).
